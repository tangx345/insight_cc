# Table of Contents
1. [Files](README.md#files)
2. [Solution explanation](README.md#solution-explanation)
3. [Input format](README.md#input-format)
4. [Output format](README.md#output-format)
5. [Source code introduction](README.md#source-code-introduction)
6. [Must know](README.md#must-know)

# Files

There are 3 main categories of files generated by developer.
* `donation-analytics.py` this is the `python` file that will complete the data process request in the challenge, it is located in `./src/`.
* `itcont.txt`,`percentile.txt`,`repeat_donors.txt` these files are self-created for tests, same files exist under `input` and `output` folders for each test folder `./insight_testsuite./tests./test_x`.
* `run.sh` and `run_test.sh` are bash files to execute the program and get output, for test cases it will compare the output with existing correct answer.

# Solution explanation

The main data structure used in the program is hash table, or `dict` in python. 

Each donor's identity can be specified by their `NAME + ZIP_CODE` and be used as `key` (README Details section : you can assume two contributions are from the same donor if the `names and zip codes` are identical). If the `key` has already appeared in donors' database, then we know that this is a repeat donor; if the `key` is never seen, then this is a new donor and we add related information to donor's database.

The value for donors' database includes `[CMTE_ID, TRANSACTION_DT, TRANSACTION_AMT]`, by comparing the date we can identify if current stream or database record is later in time, i.e. a repeat donation to be output.

Each recipient's identity can be specified by their `YEAR + ZIP_CODE + CMTE_ID` and be used as `key` (README Details section : donations streaming in from repeat donors so far for that `calendar year, recipient and zip code`). If the `key` has already appeard in recipient's database, then we know that this recipient has received donation from same calendar year and zip code before, so we add the current donation amount to this recipient + year + zip code; if the `key` is never seen we add related information to recipients' database.

The value for recipients' database includes `[[TRANSACTION_AMT sorted list], TRANSACTION_AMT in total]`, by calculating the percentile index from wiki `n = ceiling(P/100*N)` we can calculate and output required informations.

# Input format

The input stream are in `FEC format`, so I know exactly what columns I need to achive the information I need. And I set several selection rules for determine if an input stream is valid or not:

* OTHER_ID is non-empty
* Any of the remaining useful variable is empty
* If NAME contains any character other than letter, space, comma and period, it is considered as malformed
* If ZIP_CODE contains any character other than digits, or is shorter than 5 digits, it is considered as malformed
* If TRANSACTION_DT is not 8 digits (mmddyyyy), or it's number is out of range (mm should be 01-12, dd should be 01-31, yyyy should be 2000-2018), it is considered as malformed
* If TRANSACTION_AMT cannot be converted to a float number, it is considered as malformed

Any invalid input stream is discarded.

# Output format

Output is formatted as described by README, and the reptile is rounded to nearest integer. However, since no requirement has been made to total transaction amount, it is not rounded and will output float number if not a integer.

# Source code introduction

Source code contains two parts:

* `class DonationAnalysis()` this class contains private variables which are database and formatted output stream, as well as methods to check if input stream is valid, and if the input stream is repeat donor.
* remaining script lines opens input .txt files, read lines into data stream, pass it to class variable for computation, and print output stream to output .txt files if a repeat donor is found.

Detailed introduction of each functions in the class can be found in comments from source code.

# Must-know

* Source code is written and need to be executed under python 3.0 environment
* In order for stability under different environment, no extra library or package is used unless `sys` and `math`
* `percentile.txt` is considered to contain only a single number, it not program will exit and print error message
* Input streams from `itcont.txt` must be following `FEC format`, since there is no information like `title`, program will take certain columns from input stream, column numbers are pre-defined. If format is incorrect it will not read correct information into database.
